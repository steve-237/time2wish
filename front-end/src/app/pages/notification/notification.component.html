<button mat-icon-button [matMenuTriggerFor]="notificationsMenu">
  <mat-icon [matBadge]="notificationService.unreadCount$ | async" 
            matBadgeColor="warn"
            matBadgeSize="small">notifications</mat-icon>
</button>

<mat-menu #notificationsMenu="matMenu" class="notification-menu">
  <div class="p-3 max-w-xs">
    <div class="flex justify-between items-center mb-2">
      <h3 class="font-medium">Notifications</h3>
      <button mat-button color="primary" (click)="notificationService.markAllAsRead()">
        Tout marquer comme lu
      </button>
    </div>
    
    <mat-divider></mat-divider>

    <div class="max-h-80 overflow-auto">
      @for (notification of notificationService.notifications$ | async; track notification.id) {
        <div class="p-2 border-b border-gray-100" 
             [class.bg-blue-50]="!notification.read">
          <div class="flex justify-between items-start">
            <div>
              <p class="font-medium">{{notification.title}}</p>
              <p class="text-sm">{{notification.message}}</p>
            </div>
            <div class="text-xs text-gray-500">
              {{formatDate(notification.date)}}
            </div>
          </div>
          @if (!notification.read) {
            <button mat-button color="primary" class="!text-xs"
                    (click)="notificationService.markAsRead(notification.id)">
              Marquer comme lu
            </button>
          }
        </div>
      }
      @if ((notificationService.notifications$ | async)?.length === 0) {
        <div class="p-4 text-center text-gray-500">
          Aucune notification
        </div>
      }
    </div>
  </div>
</mat-menu>