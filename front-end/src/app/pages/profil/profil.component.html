<div class="profile-modal p-6 min-w-52">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-xl font-bold flex items-center gap-2">
      <mat-icon>person</mat-icon>
      {{ 'profil.header.title' | transloco }}
    </h2>
    <div class="flex gap-2">
      <button
        mat-icon-button
        (click)="toggleEditMode()"
        [matTooltip]="editMode ? ('profil.header.tooltip_view' | transloco) : ('profil.header.tooltip_edit' | transloco)"
      >
        <mat-icon>{{ editMode ? "lock" : "edit" }}</mat-icon>
      </button>
      <button mat-icon-button (click)="dialogRef.close()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  @if (isLoading) {
  <div class="flex justify-center py-8">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
  }

  @if (!isLoading) {
  <div>
    <div class="flex flex-col items-center mb-6">
      <div class="relative">
        @if (editMode) { 
          @if (profileImage) {
            <img
              [src]="profileImage"
              class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg"
              (click)="fileInput.click()"
            />
          } @else {
            <mat-icon
              class="!w-32 !h-32 !text-9xl rounded-full object-cover border-4 border-white shadow-lg cursor-pointer"
              (click)="fileInput.click()"
              >account_circle</mat-icon
            >
          }
          <input #fileInput type="file" accept="image/*" hidden (change)="onFileSelected($event)" />
        } @else { 
          @if (profileImage) {
            <img
              [src]="profileImage"
              class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg"
            />
          } @else {
            <mat-icon class="!w-32 !h-32 !text-9xl rounded-full object-cover border-4 border-white shadow-lg"
              >account_circle</mat-icon
            >
          } 
        }
      </div>
    </div>

    @if (!editMode) {
    <div class="space-y-4">
      <div class="mb-4">
        <h3 class="text-sm font-medium text-gray-500">{{ 'profil.fields.name' | transloco }}</h3>
        <p class="text-lg">{{ profileForm.get("fullName")?.value || "-" }}</p>
      </div>

      <div class="mb-4">
        <h3 class="text-sm font-medium text-gray-500">{{ 'profil.fields.email' | transloco }}</h3>
        <p class="text-lg">{{ profileForm.get("email")?.value || "-" }}</p>
      </div>

      <div class="mb-4">
        <h3 class="text-sm font-medium text-gray-500">{{ 'profil.fields.bio' | transloco }}</h3>
        <p class="text-lg whitespace-pre-line">
          {{ profileForm.get("bio")?.value || ('profil.placeholders.no_bio' | transloco) }}
        </p>
      </div>

      <div class="flex items-center gap-2">
        <mat-icon>{{ profileForm.get("notifications")?.value ? "notifications_active" : "notifications_off" }}</mat-icon>
        <span>
          {{ 'profil.fields.notifications_status' | transloco }} : 
          {{ profileForm.get("notifications")?.value ? ('profil.status.enabled' | transloco) : ('profil.status.disabled' | transloco) }}
        </span>
      </div>
    </div>
    }

    @if (editMode) {
    <form [formGroup]="profileForm" class="space-y-4">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ 'profil.fields.name' | transloco }}</mat-label>
        <input matInput formControlName="fullName" />
        @if (profileForm.get('fullName')?.hasError('required')) {
          <mat-error>{{ 'profil.errors.name_required' | transloco }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ 'profil.fields.email' | transloco }}</mat-label>
        <input matInput formControlName="email" type="email" />
        @if (profileForm.get('email')?.hasError('required')) {
          <mat-error>{{ 'profil.errors.email_required' | transloco }}</mat-error>
        } 
        @if (profileForm.get('email')?.hasError('email')) {
          <mat-error>{{ 'profil.errors.email_invalid' | transloco }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ 'profil.fields.bio' | transloco }}</mat-label>
        <textarea matInput formControlName="bio" rows="3"></textarea>
      </mat-form-field>

      <mat-slide-toggle formControlName="notificationsEnabled" color="primary">
        {{ 'profil.fields.receive_notifications' | transloco }}
      </mat-slide-toggle>

      <div class="flex justify-end gap-3 pt-4">
        <button mat-raised-button type="button" (click)="cancelEdit()" color="primary">
          {{ 'profil.actions.cancel' | transloco }}
        </button>
        <button mat-raised-button color="primary" (click)="saveProfile()" [disabled]="!profileForm.valid">
          {{ 'profil.actions.save' | transloco }}
        </button>
      </div>
    </form>
    }
  </div>
  <div class="mt-8 pt-4 border-t border-gray-200">
    <button
      mat-flat-button
      (click)="deleteAccount()"
      class="w-full text-lg !bg-red-500 !text-white shadow-md hover:shadow-lg transition-shadow"
    >
      <mat-icon class="!text-white">delete_forever</mat-icon>
      {{ 'profil.actions.delete_account' | transloco }}
    </button>
  </div>
  }
</div>