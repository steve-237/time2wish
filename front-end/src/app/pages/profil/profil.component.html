<div
  class="profile-modal flex flex-col max-h-[90vh] overflow-hidden bg-white rounded-xl shadow-xl"
>
  <div
    class="flex justify-between items-center p-6 border-b border-gray-100 shrink-0"
  >
    <h2 class="text-xl font-bold flex items-center gap-2 m-0">
      <mat-icon>person</mat-icon>
      {{ "profil.header.title" | transloco }}
    </h2>
    <div class="flex gap-2">
      <button
        mat-icon-button
        (click)="toggleEditMode()"
        [matTooltip]="
          editMode
            ? ('profil.header.tooltip_view' | transloco)
            : ('profil.header.tooltip_edit' | transloco)
        "
      >
        <mat-icon>{{ editMode ? "lock" : "edit" }}</mat-icon>
      </button>
      <button mat-icon-button (click)="dialogRef.close()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <div class="flex-1 overflow-y-auto p-6 custom-scrollbar">
    @if (isLoading) {
    <div class="flex justify-center py-8">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
    } @else {
    <div class="flex flex-col items-center mb-6">
      <div class="relative">
        @if (editMode) {
        <img
          [src]="profileImage"
          (click)="fileInput.click()"
          class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg cursor-pointer hover:opacity-90"
        />
        <input
          #fileInput
          type="file"
          accept="image/*"
          hidden
          (change)="onFileSelected($event)"
        />
        } @else {
        <img
          [src]="profileImage"
          class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg"
        />
        }
      </div>
    </div>

    @if (!editMode) {
    <div class="space-y-5">
      <div>
        <h3
          class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1"
        >
          {{ "profil.fields.name" | transloco }}
        </h3>
        <p class="text-base font-medium text-gray-800">
          {{ profileForm.get("fullName")?.value || "-" }}
        </p>
      </div>
      <div>
        <h3
          class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1"
        >
          {{ "profil.fields.email" | transloco }}
        </h3>
        <p class="text-base font-medium text-gray-800">
          {{ profileForm.get("email")?.value || "-" }}
        </p>
      </div>
      <div>
        <h3
          class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1"
        >
          {{ "profil.fields.bio" | transloco }}
        </h3>
        <p
          class="text-sm text-gray-700 whitespace-pre-line bg-gray-50 p-3 rounded-lg"
        >
          {{
            profileForm.get("bio")?.value ||
              ("profil.placeholders.no_bio" | transloco)
          }}
        </p>
      </div>
      <div
        class="flex items-center gap-3 p-3 border border-gray-100 rounded-lg"
      >
        <mat-icon class="text-gray-400">{{
          profileForm.get("notifications")?.value
            ? "notifications_active"
            : "notifications_off"
        }}</mat-icon>
        <span class="text-sm font-medium"
          >{{ "profil.fields.notifications_status" | transloco }} :
          <span class="text-blue-600">{{
            profileForm.get("notifications")?.value
              ? ("profil.status.enabled" | transloco)
              : ("profil.status.disabled" | transloco)
          }}</span></span
        >
      </div>
    </div>
    } @else {
    <form [formGroup]="profileForm" class="space-y-4">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ "profil.fields.name" | transloco }}</mat-label>
        <input matInput formControlName="fullName" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ "profil.fields.email" | transloco }}</mat-label>
        <input matInput formControlName="email" type="email" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>{{ "profil.fields.bio" | transloco }}</mat-label>
        <textarea matInput formControlName="bio" rows="3"></textarea>
      </mat-form-field>
      <mat-slide-toggle formControlName="notificationsEnabled" color="primary">
        {{ "profil.fields.receive_notifications" | transloco }}
      </mat-slide-toggle>
    </form>
    } }
  </div>

  @if (!isLoading && editMode) {
  <div
    class="flex items-center justify-between p-4 border-t border-gray-100 shrink-0 bg-white"
  >
    <div class="flex-none">
      <button
        mat-flat-button
        type="button"
        (click)="deleteAccount()"
        class="!bg-red-50 !text-red-600 hover:!bg-red-600 hover:!text-white transition-all py-2"
      >
        <mat-icon>delete_forever</mat-icon>
        {{ "profil.actions.delete_account" | transloco }}
      </button>
    </div>

    <div class="flex items-center gap-3">
      <button mat-button type="button" (click)="cancelEdit()" class="px-6">
        {{ "profil.actions.cancel" | transloco }}
      </button>

      <button
        mat-raised-button
        color="primary"
        (click)="saveProfile()"
        [disabled]="profileForm.invalid"
        class="px-6 shadow-md"
      >
        {{ "profil.actions.save" | transloco }}
      </button>
    </div>
  </div>
  }
</div>
